# Hedge_optima આર્કિટેક્ચર પ્રવાહ (Flow Summary)

નીચેના 5 મુખ્ય સ્ટેપ્સમાં આખી પ્રક્રિયા વહેંચાયેલી છે:

## 1) સિગ્નલ ઇન્જેશન (Signal Ingestion Layer)
- સ્ત્રોત: એક્સેલ શીટ અથવા તમારી ટ્રેડિંગ સ્ટ્રેટેજી દ્વારા જનરેટ થયેલ સિગ્નલ.
- પ્રોસેસ: `/signal` એન્ડપોઇન્ટ (FastAPI) દ્વારા ડેટા સિસ્ટમમાં પ્રવેશે છે.
- લોગિંગ: દરેક કાચો ડેટા `signal_logs` ટેબલમાં સેવ થાય છે, જેથી ભવિષ્યમાં ઓડિટ કરી શકાય.

## 2) પેર એન્જિન અને વેલિડેશન (Validation & Pair Engine)
- સ્કીમા નોર્મલાઇઝેશન: સિગ્નલને સિસ્ટમ સમજી શકે તેવા સ્ટાન્ડર્ડ ફોર્મેટમાં ફેરવવામાં આવે છે.
- ડિસ્ટ્રિબ્યુટેડ લૉક્સ (Redis): એક જ સિગ્નલ બે વાર પ્રોસેસ ન થાય તે માટે Redis Lock નો ઉપયોગ થાય છે.
- Idempotency Check: સિસ્ટમ ચેક કરે છે કે આ ઓર્ડર પહેલા એક્ઝિક્યુટ થયો તો નથી ને?

## 3) રિસ્ક મેનેજમેન્ટ (Risk & Rule Engine)
- કિલ સ્વીચ / સર્કિટ બ્રેકર: જો સિસ્ટમમાં મોટી ભૂલ અથવા જોખમ થાય, તો એક્ઝિક્યુશન અટકાવી દે છે.
- લોસ લિમિટ: `user_settings` મુજબ મેક્સિમમ લોસ ચેક થાય છે.
- સેશન ગેટ: ટ્રેડિંગના નક્કી કરેલા સમય દરમિયાન જ ઓર્ડર આગળ વધે છે.

## 4) ટોકન રિઝોલ્યુશન (Instrument Token Resolver)
- ડેટાબેઝ લુકઅપ: સિસ્ટમ `instrument_tokens` ટેબલમાંથી બ્રોકરનો (Zerodha/Angel/Upstox/Dhan) યુનિક ટોકન મેળવે છે.
- ડાયનેમિક ફિલ્ટર: NOW + NEXT expiry અને NIFTY previous close +/- 20 strikes મુજબ જ ટોકન snapshot રાખવામાં આવે છે.

## 5) એક્ઝિક્યુશન એન્જિન (Order Execution & Worker)
- Redis Queue: ઓર્ડરને લાઇનમાં (Queue) મુકવામાં આવે છે જેથી સિસ્ટમ પર લોડ ન આવે.
- Order Worker: બ્રોકરની API નો ઉપયોગ કરીને MARKET ઓર્ડર પ્લેસ કરે છે.
- ઓડિટ લોગ: ઓર્ડર સફળ રહ્યો કે નિષ્ફળ, તે `order_execution_log` માં નોંધાય છે.

